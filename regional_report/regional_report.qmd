---
title: "SE US"
format: html
#echo: false
code-fold: true
warning: false
params: 
  project_id: "SE US"
execute: 
  cache: true
---


```{R}
#| code-summary: setup
#| message: false
#| warning: false
if (!requireNamespace("librarian", quietly = TRUE)) {
  # If not installed, install the package
  install.packages("librarian")
}

librarian::shelf(
  dplyr,
  here,
  htmltools,
  reactablefmtr,
  tidyverse
)

```

# `r params$project_id` Report
```{R}
#| code-summary: load data
source(here("R/getCleanedData.R"))
data <- getCleanedData() %>%
  filter(mbon.project == params$project_id)
```

```{R}

df <- data %>% mutate(
  Dataset.title = Dataset.title,
  Technical.POC.email. = Technical.POC.email.,
  erddap = erddap,
  obis = obis,
  ncei = ncei,
  .keep = "used"
)
# add colors column
source(here("R/yes_no_values.R"))  # load consts used below
df$erddap_colors <- ifelse(df$erddap %in% yes_values, "lightgreen", "lightpink")
df$obis_colors <- ifelse(df$obis %in% yes_values, "lightgreen", "lightpink")
df$ncei_colors <- ifelse(df$ncei %in% yes_values, "lightgreen", "lightpink")

# TODO: add colors lightgreen gold1 lightpink 

df %>% 
  reactable(
    theme = pff(centered = TRUE),
    defaultColDef = colDef(footerStyle = list(fontWeight = "bold")),
    columns = list(
      Dataset.title = colDef(
        minWidth = 175,
        footer = 'Total',
        cell = merge_column(
          data = .,
          merged_name = 'Technical.POC.email.',
          merged_position = 'below',
          merged_size = 14,
          size = 16,
          color = '#333333',
          spacing = -1
        )
      ),
      Technical.POC.email. = colDef(show = FALSE),
      erddap = colDef(
        minWidth = 175,
        cell = pill_buttons(
          data = .,
          color_ref = 'erddap_colors',
          box_shadow = TRUE
        )
      ),
      erddap_colors = colDef(show = FALSE),
      
      obis = colDef(
        minWidth = 175,
        cell = pill_buttons(
          data = .,
          color_ref = 'obis_colors',
          box_shadow = TRUE
        )
      ),
      obis_colors = colDef(show = FALSE),
      
      ncei = colDef(
        minWidth = 175,
        cell = pill_buttons(
          data = .,
          color_ref = 'ncei_colors',
          box_shadow = TRUE
        )
      ),
      ncei_colors = colDef(show = FALSE)
    )
  ) %>% 
  add_title(
    title = 'Client Order Summary'
  )
```
