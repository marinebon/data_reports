---
title: "SE US"
format: html
#echo: false
code-fold: true
warning: false
params: 
  project_id: "SE US"
execute: 
  cache: true
---


```{R}
#| code-summary: read in data from csv
source(here("R/getCleanedData.R"))
df <- getCleanedData()

library(glue)



# doi <- "10.25921/b2g4-bs86"

# Initialize a list to store citing DOIs for each doi in the dataframe
all_citing <- list()

# Loop through each DOI in the dataframe
for (i in seq_along(df$doi)) {
  doi <- df$doi[i]
  
    # Skip if DOI is empty or NA
  if (is.na(doi) || doi == "") {
    message(glue("Skipping empty DOI at row {i}."))
    next
  }
  
  # Create the URL for the OpenCitations API
  opcit <- glue("https://opencitations.net/index/coci/api/v1/citations/{doi}")
  
  # Fetch the data from the API
  result <- tryCatch({
    fromJSON(file = opcit)
  }, error = function(e) {
    message(glue("Error processing DOI: {doi}\n{opcit}"))
    NULL
  })
  
  # Extract the citing DOIs if the result is not NULL
  if (!is.null(result)) {
    citing <- lapply(result, function(x) x[['citing']])
    citing <- unlist(citing)
    
    # Store in the list
    all_citing[[doi]] <- citing
    
    # Print the citing DOIs
    print(glue("Citing DOIs for {doi}:"))
    print(citing)
  }
}
```